<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EasyDown - Ø§Ù„Ù…Ø­Ù…Ù„ Ø§Ù„Ø°ÙƒÙŠ</title>

<!-- PWA meta -->
<meta name="theme-color" content="#007bff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="EasyDown">

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="static/icons/icon-192.png">

<style>
:root { --primary: #007bff; --bg: #f8f9fa; }

body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
}

/* Header */
.header {
    position: absolute;
    top: 15px;
    left: 15px;
    right: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.logo {
    width: 50px;
    height: 50px;
    object-fit: contain;
}
.menu { position: relative; }
.menu-btn {
    font-size: 28px;
    background:none;
    border:none;
    cursor:pointer;
    z-index: 200;
}
.dropdown {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    position: absolute;
    top:40px;
    left:0;
    background:white;
    box-shadow:0 4px 8px rgba(0,0,0,0.2);
    border-radius:8px;
    padding:10px;
    min-width:220px;
    z-index:150;
}
.dropdown.show { max-height: 300px; }
.dropdown label, .dropdown a, .dropdown select {
    display:block;
    padding:6px;
    text-decoration:none;
    color:black;
    cursor:pointer;
}
.dropdown a:hover { background:var(--primary); color:white; }

/* Card */
.card {
    background: rgba(255,255,255,0.95);
    width: 90%;
    max-width: 500px;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    text-align: center;
    position: relative;
}
input {
    width: 100%;
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 10px;
    box-sizing: border-box;
    font-size: 16px;
    margin-bottom: 20px;
}

.download-btn {
    margin-top:20px;
    width:100%;
    padding:15px;
    background:var(--primary);
    color:white;
    border:none;
    border-radius:10px;
    display:none;
    font-size:16px;
    cursor:pointer;
    transition: transform 0.3s, opacity 0.3s;
    transform: scale(0.95);
    opacity: 0;
}
.download-btn.show { transform: scale(1); opacity:1; }

#iosInstall {
    display:none;
    padding:10px;
    background:#007bff;
    color:white;
    border-radius:8px;
    text-align:center;
    margin-bottom:10px;
    font-weight:bold;
    cursor:pointer;
}

#loadingSpinner { display:none; margin-top:10px; font-size:16px; color:#007bff; }
</style>
</head>

<body>

<div class="header">
    <div class="menu">
        <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
        <div class="dropdown" id="dropdownMenu">
            <label>Ø§Ù„Ù„ØºØ© / Language</label>
            <select id="langSwitcher" onchange="changeLang()">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
            </select>
            <a href="#" onclick="showHelp()">â“ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙ†Ø²ÙŠÙ„</a>
        </div>
    </div>
    <img src="static/logo.png" class="logo">
</div>

<div class="card">
    <div id="iosInstall">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø«Ù… Ø§Ø®ØªØ± "Add to Home Screen" Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>

    <h1 id="title">EasyDown</h1>
    <p id="subtitle">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø³Ø­Ø±</p>
    
    <input type="text" id="videoUrl" placeholder="https://..." oninput="showDownloadBtn()">

    <div id="loadingSpinner">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <button class="download-btn" id="dlBtn" onclick="startDownload()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
</div>

<script>
const texts = {
    ar:{title:"EasyDown",subtitle:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø³Ø­Ø±",dl:"ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†",
        help:`ğŸ“– ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙ†Ø²ÙŠÙ„:\n\nÙ¡. Ø§ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Instagram/TikTok/Pinterest/Likee/YouTube\nÙ¢. Ø§Ø®ØªØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø°ÙŠ ÙŠØ¹Ø¬Ø¨Ùƒ\nÙ£. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø³Ù‡Ù… Ù„Ø£Ø¹Ù„Ù‰ Ø£Ùˆ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø«Ù„Ø§Ø« ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰\nÙ¤. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ù†Ø³Ø®"\nÙ¥. Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ EasyDown ÙˆØ³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†Ù.`
    },
    en:{title:"EasyDown",subtitle:"Paste link to start magic",dl:"Download Now",
        help:`ğŸ“– Download Instructions:\n\n1. Open Instagram/TikTok/Pinterest/Likee/YouTube\n2. Choose a video you like\n3. Tap the share arrow or three dots at top-right\n4. Tap "Copy"\n5. Paste the link into EasyDown to get the video in seconds.`
    }
};

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ØºØ©
function toggleMenu(){
    const menu = document.getElementById("dropdownMenu");
    menu.classList.toggle("show");
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© Ø±Ø§Ø¨Ø·
function showDownloadBtn(){
    const url = document.getElementById('videoUrl').value;
    const btn = document.getElementById('dlBtn');
    if(url.length > 5) btn.style.display='block', btn.classList.add('show');
    else btn.style.display='none', btn.classList.remove('show');
}

// ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
function changeLang(){
    const l=document.getElementById('langSwitcher').value;
    document.body.dir=l==='ar'?'rtl':'ltr';
    document.getElementById('title').innerText=texts[l].title;
    document.getElementById('subtitle').innerText=texts[l].subtitle;
    document.getElementById('dlBtn').innerText=texts[l].dl;
}

// ØªØ¹Ù„ÙŠÙ…Ø§Øª
function showHelp(){
    const l=document.getElementById('langSwitcher').value;
    alert(texts[l].help);
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
function isValidURL(url){
    try{
        const u=new URL(url);
        const allowed=['instagram.com','tiktok.com','youtube.com','pinterest.com','likee.video'];
        if(!allowed.some(d=>u.hostname.includes(d))) return false;
        return u.protocol==='http:'||u.protocol==='https:';
    }catch{return false;}
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
function startDownload(){
    const url=document.getElementById('videoUrl').value.trim();
    if(!url || !isValidURL(url)){
        alert("âŒ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…"); 
        return;
    }
    document.getElementById('loadingSpinner').style.display='block';
    const btn = document.getElementById('dlBtn');
    btn.disabled=true;

    const formData = new FormData();
    formData.append('videoUrl', url);

    fetch('/download', {method:'POST', body: formData})
    .then(res=>{
        if(!res.ok) throw new Error("ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„"); 
        return res.blob();
    })
    .then(blob=>{
        const link = document.createElement('a');
        const filename = url.split('/').pop() + ".mp4";
        link.href = window.URL.createObjectURL(blob);
        link.download = filename;
        link.click();
    })
    .catch(err=>alert("âŒ "+err.message))
    .finally(()=>{
        document.getElementById('loadingSpinner').style.display='none';
        btn.disabled=false;
    });
}

// Ø²Ø± ØªØ«Ø¨ÙŠØª iOS
if(/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream){
    const iosDiv = document.getElementById('iosInstall');
    iosDiv.style.display='block';
    iosDiv.addEventListener('click', ()=>alert('Ø§ÙØªØ­ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø«Ù… Ø§Ø®ØªØ± Add to Home Screen'));
}

// ØªØ³Ø¬ÙŠÙ„ Service Worker
if('serviceWorker' in navigator){
    window.addEventListener('load', ()=>{
        navigator.serviceWorker.register('sw.js')
        .then(reg=>console.log('SW registered', reg))
        .catch(err=>console.log('SW failed', err));
    });
}
</script>
</body>
</html>
