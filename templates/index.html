<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EasyDown</title>

<style>
body {
    background: #111827;
    color: white;
    font-family: sans-serif;
    text-align: center;
    padding: 30px;
}

input {
    width: 90%;
    padding: 15px;
    border-radius: 12px;
    border: none;
    margin-bottom: 15px;
}

button {
    padding: 15px 25px;
    border: none;
    border-radius: 12px;
    background: #00d2ff;
    color: black;
    font-weight: bold;
    cursor: pointer;
}

#status {
    margin-top: 20px;
}
</style>
</head>
<body>

<h1>EasyDown</h1>

<input type="url" id="videoUrl" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§">
<br>
<button id="downloadBtn">ØªØ­Ù…ÙŠÙ„</button>

<div id="status"></div>

<script>

const videoUrl = document.getElementById('videoUrl');
const statusDiv = document.getElementById('status');
const downloadBtn = document.getElementById('downloadBtn');

const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
const isAndroid = /Android/.test(navigator.userAgent);

let downloading = false;

async function handleDownload() {

    const url = videoUrl.value.trim();
    if (!url) {
        statusDiv.innerHTML = "âš ï¸ Ø§Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø·";
        return;
    }

    if (downloading) return;

    downloading = true;
    downloadBtn.disabled = true;
    statusDiv.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

    try {

        const response = await fetch('/download', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url: url })
        });

        const data = await response.json();

        if (!data.success) {
            throw new Error(data.error);
        }

        const fileUrl = data.download_url;
        const filename = data.filename || "video.mp4";

        // =====================
        // iOS (Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹)
        // =====================
        if (isIOS) {

            statusDiv.innerHTML =
            "ğŸ“± Ø¨Ø¹Ø¯ ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ø¶ØºØ· Ù…Ø´Ø§Ø±ÙƒØ© Ø«Ù… Save Video";

            window.location.href = fileUrl;
        }

        // =====================
        // Android
        // =====================
        else if (isAndroid && navigator.share) {

            try {
                const videoResponse = await fetch(fileUrl);
                const blob = await videoResponse.blob();
                const file = new File([blob], filename, { type: 'video/mp4' });

                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: filename
                    });
                    statusDiv.innerHTML = "âœ… ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©";
                } else {
                    throw new Error("Cannot share");
                }

            } catch {

                const link = document.createElement('a');
                link.href = fileUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                statusDiv.innerHTML = "âœ… Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
            }

        }

        // =====================
        // Desktop
        // =====================
        else {

            const link = document.createElement('a');
            link.href = fileUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            statusDiv.innerHTML = "âœ… Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
        }

    } catch (error) {
        statusDiv.innerHTML = "âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
    }

    downloading = false;
    downloadBtn.disabled = false;
}

downloadBtn.addEventListener('click', handleDownload);

</script>

</body>
</html>
